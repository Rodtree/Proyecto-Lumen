<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Plantilla reducida
  </title>
  <link rel="stylesheet" href="css/style.css">
  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40/MKBW2W4Rhis/DbILU74C1vSrLJxCq57o941Ym01SwNsOMqvEBFlcgUa6xLiPY/NS5R+E6ztJQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/adminlte.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css" integrity="sha512-rt/SrQ4UNIaGfDyEXZtNcyWvQeOq0QLygHluFQcSjaGB04IxWhal71tKuzP6K8eYXYB6vJV4pHkXcmFGGQ1/0w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">



  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Elementos para colocar en el navbar izquierdo -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
    
    </ul>


  </nav>
  <!-- /.navbar -->

  <!-- Sidebar principal -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Logo -->
    <a href="index3.html" class="brand-link">
      <img src="/landinpage/imagen_logo.jpg" alt="img-Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">LDMPaperic</span>
    </a>

    <!-- Sidebar -->
  


      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">

          <li class="nav-item menu-open">
            <a href="#" class="nav-link active">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Menú desplegable
                <i class="right fas fa-angle-left"></i>
              </p>
            </a>
            <ul class="nav nav-treeview">
              <li class="nav-item">
                <a href="./index.html" class="nav-link active">
                  <i class="far fa-circle nav-icon"></i>
                  <p>sensores</p>
                </a>
              </li>
              <li class="nav-item">
                <a href="./index2.html" class="nav-link">
                  <i class="far fa-circle nav-icon"></i>
                  <p>productos</p>
                </a>
              </li>
            </ul>
          </li>
        
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
   











    <style>
  
      canvas {
          max-width: 1000px;
          max-height: 300px;
          margin-bottom: 20px;
      }
  </style>


    <div><h1>Datos del Sensor</h1>
    <h2>Velocidad</h2>
    <canvas id="velocidadChart"></canvas>
  </div>
  <div> <h2>Distancia</h2>
    <canvas id="distanciaChart"></canvas>
  </div>
  <script>
    let velocidadChart, distanciaChart; // Declarar los gráficos para reutilizarlos
    const maxDataPoints = 10; // Número máximo de puntos a mostrar

    async function fetchSensorData() {
        try {
            const response = await fetch('http://localhost/lumen/public/sensor-data');
            if (!response.ok) throw new Error('Error en la solicitud');
            const data = await response.json();

            // Solo mantenemos los últimos 10 datos
            const slicedData = data.slice(-maxDataPoints);

            // Crear nuevas etiquetas y datasets
            const labels = slicedData.map((dato, index) => `Dato ${index + 1}`);
            const velocidadData = slicedData.map(dato => dato.velocidad);
            const distanciaData = slicedData.map(dato => dato.distancia);

            // Crear degradado de color
            const velocidadGradient = createGradient('rgba(54, 162, 235, 0.8)', 'rgba(54, 162, 46 , 0.2)');
            const distanciaGradient = createGradient('rgba(255, 159, 64, 0.8)', 'rgba(255, 159, 64, 0.2)');

            // Actualizar o crear el gráfico de velocidad
            if (velocidadChart) {
                velocidadChart.data.labels = labels;
                velocidadChart.data.datasets[0].data = velocidadData;
                velocidadChart.update();
            } else {
                const ctxVelocidad = document.getElementById('velocidadChart').getContext('2d');
                velocidadChart = initChart(ctxVelocidad, 'Velocidad (cm/s)', labels, velocidadData, velocidadGradient, 10);
            }

            // Actualizar o crear el gráfico de distancia
            if (distanciaChart) {
                distanciaChart.data.labels = labels;
                distanciaChart.data.datasets[0].data = distanciaData;
                distanciaChart.update();
            } else {
                const ctxDistancia = document.getElementById('distanciaChart').getContext('2d');
                distanciaChart = initChart(ctxDistancia, 'Distancia (cm)', labels, distanciaData, distanciaGradient, 60);
            }
        } catch (error) {
            console.error('Error al obtener los datos del sensor:', error);
        }
    }

    function initChart(ctx, title, labels, data, gradient, maxRange) {
        return new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: title,
                    data: data,
                    borderColor: gradient,
                    backgroundColor: gradient,
                    borderWidth: 2,
                    tension: 0.4,
                    pointBackgroundColor: gradient,
                    pointRadius: 5
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top'
                    },
                    title: {
                        display: true,
                        text: title,
                        font: {
                            size: 16
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        suggestedMax: maxRange,
                        ticks: {
                            callback: function (value) {
                                return `${value} ${title.includes('Velocidad') ? 'cm/s' : 'cm'}`;
                            }
                        }
                    }
                }
            }
        });
    }

    function createGradient(startColor, endColor) {
        const ctx = document.createElement('canvas').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 1000, 0);
        gradient.addColorStop(0, startColor); // Color inicial
        gradient.addColorStop(1, endColor);  // Color final
        return gradient;
    }

    // Llamar a fetchSensorData cada 2 segundos
    fetchSensorData(); // Llamada inicial
    setInterval(fetchSensorData, 2000); // Actualizar cada 2 segundos
</script>

</div><!-- /.container-fluid -->
  













      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>


  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/js/bootstrap.min.js" integrity="sha512-7rusk8kGPFynZWu26OKbTeI+QPoYchtxsmPeBqkHIEXJxeun4yJ4ISYe7C6sz9wdxeE1Gk3VxsIWgCZTc+vX3g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- ChartJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!-- AdminLTE App -->
<script src="dist/js/adminlte.js"></script>
<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="dist/js/pages/dashboard.js"></script>
</body>
</html>
